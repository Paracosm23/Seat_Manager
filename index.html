<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Auditorium Layout Editor</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    /* Overall editor container */
    #layout-editor {
      margin-top: 20px;
    }
    /* Division container styling */
    .division {
      border: 2px solid #444;
      padding: 10px;
      margin-bottom: 15px;
    }
    .division > .header {
      font-weight: bold;
      margin-bottom: 5px;
    }
    /* Subdivision container styling */
    .subdivision {
      border: 1px dashed #0077cc;
      padding: 10px;
      margin: 10px;
    }
    .subdivision > .header {
      font-weight: bold;
      margin-bottom: 5px;
    }
    /* Row container styling */
    .seat-row-container {
      margin: 5px 0;
      border: 1px solid #ccc;
      padding: 5px;
    }
    .row-header {
      display: flex;
      align-items: center;
      margin-bottom: 5px;
      gap: 5px;
    }
    .seat-row {
      display: flex;
    }
    /* Seat styling */
    .seat {
      width: 30px;
      height: 30px;
      border: 1px solid #999;
      margin-right: 2px;
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
      cursor: pointer;
      font-size: 0.8em;
    }
    /* Active seat styling */
    .seat.active {
      background-color: #ff0;
    }
    /* Button styling */
    button {
      margin: 2px 0;
    }
  </style>
</head>
<body>
  <h1>Auditorium Layout Editor</h1>
  <p>
    Build your room by adding Divisions. Inside each division, add Subdivisions,
    and then add Rows of Seats. In a row you can update the number of seats,
    select individual seats (or drag over them), or select the entire row.
  </p>
  
  <!-- Global Controls -->
  <div id="controls">
    <button id="add-division-btn">Add Division</button>
  </div>
  
  <!-- Main Editor Container -->
  <div id="layout-editor"></div>
  
  <!-- Finalize Layout -->
  <button id="finalize-btn" style="margin-top:20px;">Finalize Layout</button>
  
  <script>
    // Global flag for drag selection
    let isDragging = false;
    document.addEventListener('mouseup', () => { isDragging = false; });
    
    // Function to toggle a seat's active state
    function toggleSeat(seat) {
      if (seat.dataset.active === "false") {
        seat.dataset.active = "true";
        seat.classList.add('active');
      } else {
        seat.dataset.active = "false";
        seat.classList.remove('active');
      }
    }
    
    // Create a seat element (individual seat)
    function createSeat(index) {
      const seat = document.createElement('div');
      seat.classList.add('seat');
      seat.textContent = index + 1;
      seat.dataset.active = "false";
      
      // Start drag selection on mousedown
      seat.addEventListener('mousedown', (e) => {
        isDragging = true;
        toggleSeat(seat);
      });
      // If dragging and the mouse moves over a seat, select it if not already active
      seat.addEventListener('mouseover', (e) => {
        if (isDragging && seat.dataset.active === "false") {
          toggleSeat(seat);
        }
      });
      // Also allow a single click to toggle selection
      seat.addEventListener('click', (e) => {
        toggleSeat(seat);
      });
      return seat;
    }
    
    // Create a row container with a header for changing the seat count
    function createRow(seatCount) {
      const rowContainer = document.createElement('div');
      rowContainer.classList.add('seat-row-container');
      
      // Row header with an input for seat count and buttons
      const header = document.createElement('div');
      header.classList.add('row-header');
      
      // Label and input field for seat count
      const label = document.createElement('span');
      label.textContent = "Seats:";
      header.appendChild(label);
      
      const seatCountInput = document.createElement('input');
      seatCountInput.type = "number";
      seatCountInput.min = "1";
      seatCountInput.value = seatCount;
      seatCountInput.style.width = "50px";
      header.appendChild(seatCountInput);
      
      // Update Row button (changes number of seats)
      const updateBtn = document.createElement('button');
      updateBtn.textContent = "Update Row";
      header.appendChild(updateBtn);
      
      // Select Row button (toggle entire row)
      const selectRowBtn = document.createElement('button');
      selectRowBtn.textContent = "Select Row";
      header.appendChild(selectRowBtn);
      
      rowContainer.appendChild(header);
      
      // Container for the seats
      const rowDiv = document.createElement('div');
      rowDiv.classList.add('seat-row');
      rowContainer.appendChild(rowDiv);
      
      // Function to render the row's seats based on a given count.
      function renderSeats(newSeatCount) {
        const currentCount = rowDiv.children.length;
        if(newSeatCount > currentCount) {
          // Add extra seats
          for(let i = currentCount; i < newSeatCount; i++){
            const seat = createSeat(i);
            rowDiv.appendChild(seat);
          }
        } else if(newSeatCount < currentCount) {
          // Remove seats from the end
          for(let i = currentCount; i > newSeatCount; i--){
            rowDiv.removeChild(rowDiv.lastChild);
          }
        }
      }
      
      // Create initial seats for this row
      for (let i = 0; i < seatCount; i++) {
        const seat = createSeat(i);
        rowDiv.appendChild(seat);
      }
      
      // Update Row button event: update the row if seat count changes
      updateBtn.addEventListener('click', function() {
        const newCount = parseInt(seatCountInput.value);
        if(isNaN(newCount) || newCount < 1) {
          alert("Invalid seat count.");
          seatCountInput.value = rowDiv.children.length;
          return;
        }
        renderSeats(newCount);
      });
      
      // Select Row button event: toggle selection for all seats in the row
      selectRowBtn.addEventListener('click', function() {
        const seats = rowDiv.querySelectorAll('.seat');
        // Check if all seats are already selected
        const allSelected = Array.from(seats).every(seat => seat.dataset.active === "true");
        seats.forEach(seat => {
          if(allSelected) {
            seat.dataset.active = "false";
            seat.classList.remove('active');
          } else {
            seat.dataset.active = "true";
            seat.classList.add('active');
          }
        });
      });
      
      return rowContainer;
    }
    
    // Create a new subdivision container
    function createSubdivision() {
      const subdivision = document.createElement('div');
      subdivision.classList.add('subdivision');
      
      // Subdivision header with name input and Add Row button
      const header = document.createElement('div');
      header.classList.add('header');
      
      const subDivNameInput = document.createElement('input');
      subDivNameInput.type = "text";
      subDivNameInput.placeholder = "Subdivision Name";
      header.appendChild(subDivNameInput);
      
      const addRowBtn = document.createElement('button');
      addRowBtn.textContent = "Add Row";
      addRowBtn.addEventListener('click', () => {
        let seatCount = prompt("Enter number of seats for this row:");
        seatCount = parseInt(seatCount);
        if (!isNaN(seatCount) && seatCount > 0) {
          const row = createRow(seatCount);
          subdivision.appendChild(row);
        } else {
          alert("Invalid number of seats.");
        }
      });
      header.appendChild(addRowBtn);
      
      subdivision.appendChild(header);
      return subdivision;
    }
    
    // Create a new division container
    function createDivision() {
      const division = document.createElement('div');
      division.classList.add('division');
      
      // Division header with name input and Add Subdivision button
      const header = document.createElement('div');
      header.classList.add('header');
      
      const divNameInput = document.createElement('input');
      divNameInput.type = "text";
      divNameInput.placeholder = "Division Name";
      header.appendChild(divNameInput);
      
      const addSubdivBtn = document.createElement('button');
      addSubdivBtn.textContent = "Add Subdivision";
      addSubdivBtn.addEventListener('click', () => {
        const subdivision = createSubdivision();
        division.appendChild(subdivision);
      });
      header.appendChild(addSubdivBtn);
      
      division.appendChild(header);
      return division;
    }
    
    // Global control: Add new Division to the layout editor
    document.getElementById('add-division-btn').addEventListener('click', () => {
      const division = createDivision();
      document.getElementById('layout-editor').appendChild(division);
    });
    
    // Finalize Layout: Gather hierarchy data and save to local storage
    document.getElementById('finalize-btn').addEventListener('click', () => {
      const layoutData = [];
      document.querySelectorAll('.division').forEach(divisionElem => {
        const divisionName = divisionElem.querySelector('input[type="text"]').value || "Unnamed Division";
        const divisionData = { name: divisionName, subdivisions: [] };
        
        divisionElem.querySelectorAll('.subdivision').forEach(subdivisionElem => {
          const subdivisionName = subdivisionElem.querySelector('input[type="text"]').value || "Unnamed Subdivision";
          const subdivisionData = { name: subdivisionName, rows: [] };
          
          subdivisionElem.querySelectorAll('.seat-row-container').forEach(rowContainer => {
            const rowDiv = rowContainer.querySelector('.seat-row');
            const rowData = [];
            rowDiv.querySelectorAll('.seat').forEach(seatElem => {
              rowData.push(seatElem.dataset.active === "true");
            });
            subdivisionData.rows.push(rowData);
          });
          divisionData.subdivisions.push(subdivisionData);
        });
        layoutData.push(divisionData);
      });
      
      localStorage.setItem('auditoriumRoomLayout', JSON.stringify(layoutData));
      alert("Layout finalized and saved!");
    });
  </script>
</body>
</html>
