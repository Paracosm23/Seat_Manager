<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Group Assignment Page</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    /* Container for the layout image (allows overlaying markers) */
    #layout-container {
      position: relative;
      display: inline-block;
      border: 1px solid #ccc;
    }
    #layout-image {
      max-width: 100%;
      display: block;
    }
    /* Marker styling (each marker represents a seat/group selection) */
    .marker {
      position: absolute;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background-color: rgba(255, 0, 0, 0.7);
      color: #fff;
      text-align: center;
      line-height: 20px;
      font-size: 12px;
      pointer-events: none;
    }
    /* Group controls styling */
    #group-controls {
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <h1>Group Assignment Page</h1>
  <p>
    Set your current group name and then click on the layout image to mark seats for that group.
  </p>
  
  <!-- Group controls: set the current group -->
  <div id="group-controls">
    <label for="group-name">Current Group Name:</label>
    <input type="text" id="group-name" placeholder="Enter group name">
    <button id="set-group-btn">Set Current Group</button>
  </div>
  
  <!-- Layout image container -->
  <div id="layout-container">
    <img id="layout-image" src="" alt="Auditorium Layout">
    <!-- Markers will be added here -->
  </div>
  
  <!-- Finalize groups button -->
  <div>
    <button id="finalize-groups-btn" style="margin-top:20px;">Finalize Groups</button>
  </div>
  
  <script>
    // Retrieve the saved layout image from localStorage
    const layoutImageData = localStorage.getItem('auditoriumRoomLayoutImage');
    if (!layoutImageData) {
      alert("No layout image found. Please create and finalize a layout first.");
      window.location.href = "index.html"; // Redirect to the layout page
    }
    
    // Set the image source to the saved PNG data
    const layoutImage = document.getElementById('layout-image');
    layoutImage.src = layoutImageData;
    
    // Variable to hold the current group name
    let currentGroup = "";
    document.getElementById('set-group-btn').addEventListener('click', () => {
      const groupName = document.getElementById('group-name').value.trim();
      if (!groupName) {
        alert("Please enter a group name.");
        return;
      }
      currentGroup = groupName;
      alert("Current group set to: " + currentGroup);
    });
    
    // Array to store marker data (each marker represents a group assignment at a position)
    const markers = [];
    
    // When the user clicks on the layout container, add a marker if a group is set
    document.getElementById('layout-container').addEventListener('click', function(e) {
      // Ensure that a group has been set
      if (!currentGroup) {
        alert("Please set a current group before clicking on the image.");
        return;
      }
      // Get the click coordinates relative to the container
      const containerRect = this.getBoundingClientRect();
      const x = e.clientX - containerRect.left;
      const y = e.clientY - containerRect.top;
      
      // Create a marker element
      const marker = document.createElement('div');
      marker.classList.add('marker');
      // Center the marker (marker is 20px x 20px)
      marker.style.left = (x - 10) + "px";
      marker.style.top = (y - 10) + "px";
      // Display the first letter of the current group as a simple label
      marker.textContent = currentGroup.charAt(0).toUpperCase();
      
      // Optionally, store extra data on the marker element
      marker.dataset.group = currentGroup;
      marker.dataset.x = x;
      marker.dataset.y = y;
      
      // Append the marker to the layout container
      this.appendChild(marker);
      
      // Save the marker data
      markers.push({
        group: currentGroup,
        x: x,
        y: y
      });
    });
    
    // When "Finalize Groups" is clicked, save the markers data to localStorage
    document.getElementById('finalize-groups-btn').addEventListener('click', () => {
      localStorage.setItem('auditoriumGroups', JSON.stringify(markers));
      alert("Groups finalized and saved!");
    });
  </script>
</body>
</html>
